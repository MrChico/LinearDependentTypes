\input{../preamble.tex}
\usepackage[margin=0.5in]{geometry}
\begin{document}
\title{Models of linear dependent type theory}
\author{Martin Lundfall}
\maketitle
\abstract
TODO
\newpage
\tableofcontents
\newpage
\section{TODO}
Clean up $M \vdash L$ and prove that $M \vdash L$ is monoidal
understand universes semantically
Let $\mathcal{L}$ be a (monoidal?) (2,1)-category. For $A, B \in \mathcal{L}_{\Gamma}$, can one define the type $f =_{[A, B]} g$ to consist of the 2-cells between f and g?
Examples of such categories:
Cat (with natural iso)
Grp
SMC
Kelly's enriched categories for more on enriched cats
\section{Preliminaries}
The paper is largely split into two sections; syntax and semantics. 
Familiarity with basic category theoretic concepts like limits, adjoints, monoidal categories is assumed.
\subsection{Dependent type theory}
A \textit{type} is a syntactic construction whose meaning and function stems from the ways in which it interacts with the derivation rules of a \textit{type theory}. Approaching type theory from the perspective of logic, we can form a first approximation of the definition of a type as a generalization of a proposition and a set.
\subsection{Linear type theory}
Linear logic is a substructural logic in which the rules of weakening and contraction:
\[
  \begin{split}
    \inference{\Gamma, \Delta \vdash B}{\Gamma, A, \Delta \vdash B}[Weak] \quad \quad 
    \inference{\Gamma, A, A, \Delta \vdash B}{\Gamma, A, \Delta \vdash B}[Contr]
    \end{split}
\]
are not admissable.\\
In other words, assumptions cannot be freely assumed or dismissed; they must be used exactly once in the conclusion. In linear logic, we are inclined to think of a sequent $A_1, A_2, \dots, A_n \vdash B$ as modelling a function or process in which the assumptions $A_1, A_2, \dots A_n$ are \textit{resources used} to yield $B$. As a first, toy example, we consider the chemical process of burning hydrogen:
\begin{ex}\label{burn}
Consider the following primitive derivation rule: 
\[
  O_2 \otimes H_2 \otimes H_2 \vdash H_2O \otimes H_2O
\]
stating that given an oxygen molecule and two hydrogen molecules, burning yields two water molecules. If weakening was admissable, we would be able to assume an additional hydrogen molecule without changes the antecedent, which does not make sense under the resource interpretation of linear logic.\\
Just as inuitionistic logic naturally extends to (dependent) type theory under the slogan of propositions as types, linear logic can be extended to a linear type theory, where sequents are decorated with proof terms:
\[
  x_1 : A_1 x_2 : A_2, \dots x_n : A_n \vdash t : B
\]
and here linearity implies that the free variables of $t$ are $x_1, x_2, \dots x_n$, each appearing exactly once.\\
Interest in linear type theory stems from disparate sources. From the perspective of (classical) computer science, it can be used for modelling state and storage, with linear variables denoting resources like pointers or files \cite{krishnaswami}, or even as a theoretical description of the resource handling of a blockchain \cite{meredith2015linear}. In quantum physics, linear types respect the no cloning theorem of quantum states, and are also proposed as a syntax for quantum computation \cite{duncan2006types}. From a semantic perspective, linear type theory can be interpreted in a symmetric monoidal closed categories, generalising the structure of a cartesian closed categories in which (non-dependent) type theories are interepreted.\\
\end{ex}
\input{fibrations}
\subsection{Enriched and higher categories}
The concept of a category can be generalized in a few different directions. In exploring semantics of linear type theory, our first encounter with such structures will be  enriched categories, where hom-sets are generalized to ``hom-objects'' of a monoidal category $\mathcal{V}$.
\begin{defn}\label{enr-cat}
  For a monoidal category $\mathcal{V}$, a \textbf{$\mathcal{V}$-enriched category} $\mathcal{C}$, consists of the following:
  \begin{enumerate}
  \item A set $\mathcal{C}_0$ of objects,
  \item for each pair $a, b \in \mathcal{C}_0$, an object $V_{a,b} \in \mathcal{V}$,
  \item for every $a, b, c \in \mathcal{C}_0$, a \textit{composition law}, i.e. a functor $M_{a, b, c} : V_{b, c} \otimes V_{a, b} \to V_{a, c}$ and
  \item an identity element $j_a : I \to V_{a, a}$
\end{enumerate}
such that for all $a, b, c, d$, the following associativity and identity diagrams commute:
    \[
      \ti
      (V_{c, d} \otimes V_{b, c}) \otimes V_{a, b} \ar[d, "{M_{b, c, d} \otimes 1_{V_{a,b}}}"] \ar[rr, "\alpha"] & & V_{c, d} \otimes (V_{b, c} \otimes V_{a, b}) \ar[d, "{1_{V_{c,d}} \otimes M_{a, b, c}}"]\\
      V_{b, d} \otimes V_{a, b} \ar[rd, "M_{a, b, d}"] & & V_{c, d} \otimes V_{a, c} \ar[ld, "M_{a, c, d}"]\\
      & V_{a, d}      &
      \kz
    \]
    \[
      \ti
      I \otimes V_{a, b} \ar[d, "j_b \otimes 1_{V_{a, b}}", swap] \ar[r, "l"] & V_{a, b} & V_{a, b} \otimes I \ar[l, "r"] \ar[d, "1_{V_{a, b}} \otimes j_a"] \\
      V_{b, b} \otimes V_{a, b} \ar[ru, "M_{a, b, b}"] & & V_{a, b} \otimes V_{a, a} \ar[lu, "M_{a, a, b}"]
      \kz
    \]
    where $a$, $l$ and $r$ are the respectively the associator and left and right unitor ismorphisms from the monoidal structure of $\mathcal{V}$.
\end{defn}
Note that for the special case of $\mathcal{V} = Set$ we get back the definition of a category. Plenty of examples of constructions in enriched categories can be found in the comprehensive introduction \textit{Basic concepts of enriched category theory} by Max Kelly, \cite{kelly}.\\
Another generalization of a category is suggested by the direction in which categories generalize sets/classes by allowing arrows between objects. Thinking of arrows as one-dimensional objects between zero-dimensional objects, one can imagine the existence of 2-dimensional arrows between 1-dimensional ones. This leads to the notion of a 2-category. These come in two different forms, strict 2-categories (or just 2-categories) or weak 2-categories (also known as bicategories). Equipped with the notion of an enriched category, strict 2-categories can be defined concisely as:
\begin{defn}
  A \textbf{(strict) 2-category} is a $Cat$-enriched category.
\end{defn}
Breaking down this definition provides a more illuminating view. A strict 2-category, $\mathcal{C}$, consists of
\begin{itemize}
\item a collection of objects $\mathcal{C}_0$,
\item for any pair of objects $a, b \in \mathcal{C}_0$, a category $C_{a, b}$, whose objects will be called ``1-morphisms'' and whose morphisms are renamed ``2-morphisms''.
\item for any object $a \in \mathcal{C}$, an ``identity'' functor $1_a : \mathbf{1} \to \mathcal{C}_{a, a}$, 
\item for any triple of objects $a, b, c \in \mathcal{C}_0$, a functor $Comp : C_{b, c} \times C_{a, b} \to C_{a, c}$
  satisfying the associativity and identity diagrams from the definition of enriched categories.
\end{itemize}
The action of $Comp$ on 1-morphisms is called ``horizontal composition'' and is written $gf := Comp(g, f)$ for $f \in \mathcal{C}_{a, b}$ and $g \in \mathcal{C}_{b, c}$, whereas the composition between 2-morphisms $\alpha : f \implies g$, $\alpha' : g \implies h$ for $f, g, h \in \mathcal{C}_{a, b}$ is written $\alpha' \circ \alpha$.
Thanks to the functoriality of $Comp$, these satisfy the following \textit{interchange law}:
\[
  (\beta' \circ \beta)(\alpha'\circ \alpha)=(\beta'\alpha')\circ(\beta\alpha)
\]\\
The path from strict 2-categories to weak 2-categories is marched to the category theoretic slogan that it is undesirable to speak of equality between objects in a category. 2-morphisms give us a way of relating 1-morphisms up to isomorphism instead of on-the-nose equality. Thus we are inclined to loosen the restriction of the associativity and unital diagrams in the definition of a 2-category to only commute up to coherent natural isomorphism:
\begin{defn}
  A \textbf{weak 2-category} $\mathcal{C}$ is a collection of objects, 1-morphisms and 2-morphisms with composition and identity functors as before, such that for all $a, b, c, d \in \mathcal{C}_0$, there exists natural isomorphisms
  \[
    \gamma :  M_{a,b,d} \circ (M_{b,c,d} \otimes 1_{V_{a,b}}) \implies M_{a, c, d} \circ (1_{V_{c, d}} \otimes M_{a, b, c}) \circ a
  \]
  \[
    \lambda : l \implies M_{a, b, b} \circ (j_b \circ 1_{V_{a,b}})
  \]
  \[
    \rho : r \implies M_{a, a, b} \circ (1_{V_{a,b}} \circ j_a)
  \]
  in other words, associated with the diagrams:
  \[
    \ti
    (V_{c, d} \otimes V_{b, c}) \otimes V_{a, b} \ar[d, "{M_{b, c, d} \otimes 1_{V_{a,b}}}"] \ar[rr, "\alpha"] & & V_{c, d} \otimes (V_{b, c} \otimes V_{a, b}) \ar[d, "{1_{V_{c,d}} \otimes M_{a, b, c}}"]\\
    V_{b, d} \otimes V_{a, b} \ar[rd, "M_{a, b, d}"] \ar[rr, "\gamma", Rightarrow, shorten <=50pt,shorten >=50pt]& & V_{c, d} \otimes V_{a, c} \ar[ld, "M_{a, c, d}"]\\
    & V_{a, d}      &
    \kz
  \]
  \[
    \ti
    I \otimes V_{a, b} \ar[d, "j_b \otimes 1_{V_{a, b}}", swap] \ar[d, "\lambda", Rightarrow, xshift=30pt, shorten <=10pt,shorten >=10pt, yshift=7pt] \ar[r, "l"] & V_{a, b} & V_{a, b} \otimes I \ar[l, "r"] \ar[d, "1_{V_{a, b}} \otimes j_a"] \ar[d, "\rho", Rightarrow, xshift=-30pt, shorten <=10pt,shorten >=10pt, yshift=7pt] \\
    V_{b, b} \otimes V_{a, b} \ar[ru, "M_{a, b, b}",swap] & & V_{a, b} \otimes V_{a, a} \ar[lu, "M_{a, a, b}"]
    \kz
  \]
  subject to the following coherence conditions:
\end{defn}


%\subsection{Spectra}
%\input{spectra}
\section{Syntax}
The particular linear dependent type theory under consideration is a inspired by the work of Krishnaswami in \cite{krishnaswami} and Vákár in \cite{vakar14}. Types are either \textit{cartesian}, in which case we simply write $\Gamma \vdash A \text{ type}$, or \textit{linear}, written $\Gamma \vdash A \text{ linear}$. When making typing judgements of linear terms, contexts will be split into two parts, separated by a semicolon. The first part contains \textit{cartesian} assumptions, for which weakening and contraction is allowed, while the second part is the \textit{linear} part, containing ephemeral assumptions that we are also inclined to think of as resources. The deduction rules for linear types will force them to occur exactly once in the term of the conclusion. Dependent types are restricted to only depend on terms of cartesian types. 
\subsection{Structural rules}
We will be dealing with the following judgements:\\
\begin{figure}[h]
\fbox{
\begin{minipage}{.5\linewidth}
\textbf{Judgement:}\\
$\vdash \Gamma \text{ ctxt}$\\
$\vdash \Gamma; \Xi \text{ ctxt}$\\
$\Gamma \vdash A \text{ type}$\\
$\Gamma \vdash A \text{ linear}$\\
$\Gamma \vdash M : A$\\
$\Gamma; \Xi \vdash M : A$\\
$\Gamma \vdash A \equiv A' \text{ type}$\\
$\Gamma \vdash A \equiv A' \text{ linear}$\\
$\Gamma \vdash M \equiv N : A$\\
$\Gamma; \Xi \vdash x \equiv y : A$
\end{minipage}
\begin{minipage}{.5\linewidth}
\textbf{Meaning:}\\
$\Gamma$ is a well-formed cartesian context.\\
$\Gamma; \Xi$ is a well-formed mixed context\\
$A$ is a cartesian type in $\Gamma$\\
$A$ is a linear type in $\Gamma$\\
$M$ is a term of the cartesian type $A$ in $\Gamma$\\
$M$ is a (linear) term of the linear type $A$ in $\Gamma; \Xi$\\
$A$ and $A'$ are equal cartesian types in $\Gamma$\\
$A$ and $A'$ are equal linear types in $\Gamma; \Xi$\\
$M$ and $N$ are equal cartesian terms of $A$ in $\Gamma$\\
$x$ and $y$ are equal linear terms of $A$ in $\Gamma; \Xi$
\end{minipage}}
\caption{Judgements of linear dependent type theory}
\label{judgements}
\end{figure}
\\
The basic structural rules for the linear dependent type theory are given in \ref{struc}. Omitted are the rules concerning judgemental equality, which specify that it is an equality relation which is congruent with respect to the other structural rules.
\begin{figure}[H]
  \centering
  \input{struc}
  \caption{Structural rules}
  \label{struc}
\end{figure}
$\mathcal{J}$ denotes a judgement of the form $A \text{ type}$, $A \text{ linear}$ or $M : A$ (for a cartesian type $A$).
\subsection{Cartesian typing rules}
The cartesian types that we will use are the standard $\Pi$, $\Sigma$ and $Id$-types. For $\Sigma$ and $Id$ we will introduce an extra elimination and computational rule for the case where the type being eliminated into is linear.\\
\begin{figure}[H]
\fbox{
\begin{minipage}{.5\linewidth}
\[
\inference{\Gamma \vdash A \type \quad \Gamma, x : A \vdash B \type}
{\Gamma \vdash \Pi_{x : A}B \type}[$\Pi$-F]
\]\\
\[
\inference{\Gamma, x : A \vdash b : B}
{\Gamma \vdash \lambda x.b : \Pi_{x : A}B}[$\Pi$-I]
\]\\
\[
\inference{\Gamma \vdash t : \Pi_{x : A}B \type\\
\Gamma \vdash M : A}
{\Gamma \vdash t(M) : B[M/x]}[$\Pi$-E]
\]\\
\[
\inference{\Gamma, x : A \vdash b : B \quad \Gamma \vdash M : A}
{\Gamma \vdash \lambda x. b(M) \equiv b[M/x] : B[M/x]}[$\Pi$-C]
\]\\
\[
\inference{\Gamma \vdash A \type \quad \Gamma, x : A \vdash B \type}
{\Gamma \vdash \Sigma_{x : A}B \type}[$\Sigma$-F]
\]\\
\end{minipage}
\begin{minipage}{.5\linewidth}
\[
\inference{\Gamma \vdash M : A \quad \Gamma \vdash N : B[M/x]}
{\Gamma \vdash (M, N) : \Sigma_{x : A}B}[$\Sigma$-I]
\]\\
\[
\inference{\Gamma, t : \Sigma_{x : A}B \vdash C \type\\
\Gamma, x : A, y : B \vdash c : C[(x, y)/t]\\
\Gamma \vdash s : \Sigma_{x : A}B}
{\Gamma \vdash \hat c[s] : C[s/t]}[$\Sigma-$E$_1$]
\]\\
\[
\inference{\Gamma, t : \Sigma_{x : A}B \vdash C \linear\\
\Gamma, x : A, y : B; \Xi \vdash c : C[(x, y)/t]\\
\Gamma \vdash s : \Sigma_{x : A}B}
{\Gamma; \Xi \vdash \hat c[s] : C[s/t]}[$\Sigma$-E$_2$]
\]\\
\[
\inference{\Gamma \vdash \hat c[(a, b)] : C[(a, b)/t]}
{\Gamma \vdash \hat c[(a, b)] \equiv c[(a, b)/t] : C[(a, b)/t]}[$\Sigma$-C$_1$]
\]\\
\[
\inference{\Gamma; \Xi \vdash \hat c[(a, b)] : C[(a, b)/t]}
{\Gamma; \Xi \vdash \hat c[(a, b)] \equiv c[(a, b)/t] : C[(a, b)/t]}[$\Sigma$-C$_2$]
\]\\
\end{minipage}
}
\caption{(Cartesian) dependent sum and product types}
\label{sigmaPi}
\end{figure}
\begin{figure}[H]
\fbox{
\begin{minipage}{.37\linewidth}
\[
\inference{\Gamma \vdash M : A \quad \Gamma \vdash N : A}
{\Gamma \vdash M =_A N \type}[=-F]
\]\\
\[
\inference{\Gamma \vdash M : A}
{\Gamma \vdash refl(M) : M =_A M}[=-I]
\]\\
\[
\inference{\Gamma, x, y : A, p : x =_Ay \vdash C \type\\
\Gamma, z : A \vdash c: C[z/x, z/y, refl(z)/p]\\
\Gamma \vdash M : A \quad \Gamma \vdash N : A\\
\Gamma \vdash P : M =_A N}
{\Gamma \vdash R^{Id}_{[x, y, p]}(c, M, N, P) : C[M/x, N/y, P/p]}[=-E$_1$]
\]\\
\end{minipage}
\begin{minipage}{.63\linewidth}
\[
\inference{\Gamma, x, y : A, p : x =_Ay \vdash C \linear\\
\Gamma, z : A; \Xi \vdash c: C[z/x, z/y, refl(z)/p]\\
\Gamma \vdash M : A\\
\Gamma \vdash N : A\\
\Gamma \vdash P : M =_A N}
{\Gamma; \Xi[M/z] \vdash R^{Id}_{[x, y, p]}(c, M, N, P) : C[M/x, N/y, P/p]}[=-E$_2$]
\]\\
\[
\inference{\Gamma \vdash R^{Id}_{[x, y, p]}(c, M, M, refl(M)) : C[M/x, M/y, refl(M)/p]}
{\Gamma \vdash R^{Id}_{[x, y, p]}(c, M, M, refl(M)) \equiv c[M/z]: C[M/x, M/y, refl(M)/p]}
[=-C$_1$]
\]\\
\[
\inference{\Gamma; \Xi \vdash R^{Id}_{[x, y, p]}(c, M, M, refl(M)) : C[M/x, M/y, refl(M)/p]}
{\Gamma; \Xi \vdash R^{Id}_{[x, y, p]}(c, M, M, refl(M)) \equiv c[M/z]: C[M/x, M/y, refl(M)/p]}
[=-C$_2$]
\]\\
\end{minipage}
}
\caption{(Cartesian) identity type}
\label{id}
\end{figure}
\subsection{Linear typing rules}
Perhaps the most important linear types are the $\otimes$- and $I$-types, as they will provide an interpretation of linear contexts: we will think of the context $\Xi :\equiv x_1 : A_1, x_2 : A_2, \dots x_n : A_n$ as represented by the assumption $x_1 \otimes x_2 \otimes \dots x_n : A_1 \otimes A_2 \otimes \dots A_n$.
\begin{figure}[H]
\fbox{
  \begin{minipage}{.5\linewidth}
\[
\inference{\Gamma \vdash A \linear \quad \Gamma \vdash B \linear}{\Gamma \vdash A \otimes B \linear}[$\otimes$-F]
\]\\
\[
\inference{\Gamma; \Xi \vdash a : A \quad \Gamma; \Xi' \vdash b : B}{\Gamma; \Xi, \Xi' \vdash (a, b) : A \otimes B}[$\otimes$-I]
\]\\
\[
\inference{\Gamma; \Xi' \vdash t : A \otimes B \quad \Gamma; \Xi, x : A, y : B \vdash c : C}{\Gamma;\Xi, \Xi' \vdash \text{let $x, y$ be $t$ in $c : C$}}[$\otimes$-E]
\]\\
\[
\inference{\Gamma;\Xi \vdash \text{let $x, y$ be $(a, b)$ in $c : C$}}
{\Gamma; \Xi \vdash \text{let $x, y$ be $(a, b)$ in $c$} \equiv c[a/x][b/y] : C}
[$\otimes$-C]
\]
\end{minipage}
\begin{minipage}{.5\linewidth}
\[
\inference{}{\Gamma \vdash I \linear}[I-F]
\]\\
\[
\inference{}{\Gamma; \cdot \vdash * : I}[I-I]
\]\\
\[
\inference{\Gamma; \Xi \vdash c : C \quad \Gamma; \Xi' \vdash t : I}
{\Gamma; \Xi, \Xi' \vdash \text{ let $t$ be $*$ in c : C}}[I-E]
\]\\
\[
\inference{\Gamma; \Xi \vdash \text{ let $*$ be $*$ in $c : C$}}
{\Gamma; \Xi \vdash \text{ let $*$ be $*$ in $c$} \equiv c : C }[I-C]
\]
\end{minipage}
}
\caption{Linear $\otimes$ and $I$ type formers}
\label{tensor}
\end{figure}
The typing rules for the remaining linear rules are standard.
\begin{figure}[H]
\fbox{
\begin{minipage}{.4\linewidth}
\[
\inference{\Gamma \vdash A \linear \quad \Gamma \vdash B \linear}{\Gamma \vdash A \multimap B \linear}[$\multimap$-F]
\]\\
\[
\inference{\Gamma; \Xi, x : A \vdash b : B}{\Gamma; \Xi \vdash \lambda x. b : A \multimap B}[$\multimap$-I]
\]\\
\[
\inference{\Gamma; \Xi \vdash f : A \multimap B \quad \Gamma; \Xi' \vdash a : A}{\Gamma; \Xi, \Xi' \vdash f(a) : B}[$\multimap$-E]
\]\\
\[
\inference{\Gamma; \Xi \vdash \lambda x. b(a) : B}
{\Gamma; \Xi \vdash \lambda x. b(a) \equiv b[a/x] : B}[$\multimap$-C]
\]
\[
\inference{\Gamma \vdash A \linear \quad \Gamma \vdash B \linear}{\Gamma \vdash A \& B \linear}[\&-F]
\]\\
\[
\inference{\Gamma; \Xi \vdash a : A \quad \Gamma; \Xi \vdash b : B}{\Gamma; \Xi \vdash \langle a, b \rangle : A \& B}[\&-I]
\]\\
\[
\inference{\Gamma; \Xi \vdash t : A \& B}{\Gamma; \Xi \vdash \text{fst}(t) : A}[\&-E$_1$]
\]\\
\[
\inference{\Gamma; \Xi \vdash t : A \& B}{\Gamma; \Xi \vdash \text{snd}(t) : B}[\&-E$_2$]
\]\\
\[
\inference{\Gamma; \Xi \vdash \text{fst}(\langle a, b \rangle): A}
{\Gamma; \Xi \text{fst}(\langle a, b \rangle) \equiv a : A}[\&-C$_1$]
\]\\
\[
\inference{\Gamma; \Xi \vdash \text{snd}(\langle a, b \rangle): B}
{\Gamma; \Xi \vdash \text{snd}(\langle a, b \rangle) \equiv b : B}[\&-C$_2$]
\]
\end{minipage}
\begin{minipage}{.6\linewidth}
\[
\inference{\Gamma \vdash A \linear \quad \Gamma \vdash B \linear}{\Gamma \vdash A \oplus B \linear}[$\oplus$-F]
\]\\
\[
\inference{\Gamma; \Xi \vdash a : A}{\Gamma \Xi \vdash \text{inl}(a): A \oplus B}[$\oplus$-I$_1$]
\]\\
\[
\inference{\Gamma; \Xi \vdash b : B}{\Gamma \Xi \vdash \text{inr}(b): A \oplus B}[$\oplus$-I$_2$]
\]\\
\[
\inference{\Gamma; \Xi, x : A \vdash c : C \quad \Gamma; \Xi, y : B \vdash d : C; \Gamma; \Xi' \vdash t : A \oplus B}
{\Gamma; \Xi, \Xi' \vdash \text{case $t$ of inl$(x) \to c || $inr$(y) \to d : C$}}[$\oplus$-E]
\]\\
\[
  \inference{\Gamma; \Xi \vdash \text{case inl$(a)$ of inl$(x) \to c || $inr$(y) \to d: C$}}{\Gamma; \Xi \vdash \text{case inl$(a)$ of inl$(x) \to c || $inr$(y) \to d \equiv c[a/x] : C$}}[$\oplus$-C$_1$]
\]\\
\[
  \inference{\Gamma; \Xi \vdash \text{case inr$(b)$ of inl$(x) \to c || $inr$(y) \to d: C$}}{\Gamma; \Xi \vdash \text{case inr$(b)$ of inl$(x) \to c || $inr$(y) \to d \equiv d[b/y] : C$}}[$\oplus$-C$_2$]
\]\\
\[
  \inference{}{\Gamma \vdash \top \linear}[$\top$-F]
\]\\
\[
  \inference{\vdash \Gamma; \Xi \text{ctxt}}{\Gamma; \Xi \vdash ! : \top}[$\top$-I]
\]\\
\[
  \inference{}{\Gamma \vdash 0 \linear}[0-F]
\]\\
\[
  \inference{\Gamma; \Xi \vdash t : 0}{\Gamma; \Xi, \Xi' \vdash EFQ(t) : B}[0-E]
\]\\
\end{minipage}
}
\caption{Linear $\multimap$, $\&$, $\oplus$, $\top$ and $0$ type formers}
\label{restoflinear}
\end{figure}


\subsection{Linear-Cartesian interplay}
We introduce two the modal operators $M$ and $L$, which transfers a linear type/term to its cartesian counterpart and vice versa. Semantically, this will establish a fiberwise adjunction between the categories of linear and cartesian types:
\[
\ti
\mathcal{L}_{\Gamma} \ar[r, "M"{name=A, below}, bend right] & \mathcal{T}_{\Gamma} \ar[l, "L"{name=B, above}, bend right] \ar[from=A, to=B, symbol=\vdash]
\kz
\]
where the exponential modality from traditional linear logic is understood as the comonad $! = LM$. The decomposition of the exponential into an adjunction goes back to at least \cite{bentonmixed}, and is given an interesting new light in \cite{licata2017fibrational}, where it is seen as a particular example of a more general way to encode structure in contexts.

Below are the syntactic rules for the operators $M$ and $L$. \\
\fbox{
\begin{minipage}{.5\linewidth}
\[
\inference{\Gamma \vdash A \type}{\Gamma \vdash A_L \linear}[L-F]
\]\\
\[
\inference{\Gamma \vdash a : A}{\Gamma ; \cdot \vdash a_L : A_L}[L-I]
\]\\
\[
\inference{(\Gamma \vdash B \linear) \\
(\vdash \Gamma; \Xi' \text{ ctxt})\\ \Gamma; \Xi \vdash y : A_L \quad \Gamma, x : A; \Xi' \vdash t : B}{\Gamma; \Xi, \Xi' \vdash \text{let  $x$ be $y$ in }t : B}[L-E]
\]\\
\[
\inference{\Gamma; \Xi \vdash \text{let  $x$ be $s_L$ in }t : B}{\Gamma; \Xi \vdash \text{let  $x$ be $s_L$ in }t \equiv t[s/x]  : B}[L-C]
\]\\
\[
    \inference{\Gamma; y : A_L, \Xi \vdash t, t' : B \\
      \Gamma, x : A; \Xi \vdash t[x_L/y] \equiv t'[x_L/y]\\
      \Gamma; \Xi' \vdash a : A_L }
    {\Gamma; \Xi, \Xi' \vdash t[a/y] \equiv t'[a/y]}[L-U]
\]
\end{minipage}
\begin{minipage}{.5\linewidth}
\[
\inference{\Gamma \vdash B \linear}{\Gamma \vdash B_M \type}[M-F]
\]\\
\[
\inference{\Gamma ; \cdot \vdash b : B}{\Gamma \vdash b_M : B_M}[M-I]
\]\\
\[
\inference{
\Gamma \vdash t : B_M\\
}{\Gamma; \cdot \vdash \sigma(t) : B \\}[M-E]
\]\\
\[
\inference{
\Gamma \vdash b_M : B_M\\
}{\Gamma; \cdot \vdash \sigma(b_M) \equiv b : B \\}[M-C$_1$]
\]
\[
\inference{
\Gamma \vdash \sigma(t)_M : B_M\\
}{\Gamma \vdash \sigma(t)_M \equiv t : B_M \\}[M-C$_2$]
\]
\end{minipage}
}\\
To motivate the semantic interpretation of $L$ and $M$ as adjoint functors, we should first of all expect them to satisfy basic functoriality conditions. For an arbitrary morphism, $\Gamma; x : A \vdash f : B$, the image of $f$ under $M$ is given by:\\
\[
  \begin{split}
  \Gamma; x : A &\vdash f : B\\
  \Gamma, y : A_M &\vdash y : A_M\\
  \Gamma, y : A_M; \cdot &\vdash \sigma(y) : A\\
  \Gamma, y : A_M; \cdot &\vdash f[\sigma(y)/x] : B\\
  \Gamma, y : A_M &\vdash f[\sigma(y)/x]_M : B_M\\
  \end{split}
\]\\
Similarly, for $\Gamma, x : A \vdash f : B$ we get $L(f)$ via:
\[
  \begin{split}
    \Gamma, x : A &\vdash f : B\\
    \Gamma, x : A; \cdot &\vdash f_L : B_L\\
    \Gamma; y : A_L &\vdash y : A_L\\
    \Gamma; y : A_L &\vdash \text{let $x$ be $y$ in $f_L$} : B_L
  \end{split}
\]\\
First, we check that $M(id_A) = id_{MA}$.  The image of the identity morphism $\Gamma; x : A \vdash x : A$ is:
\[
  \Gamma, y : A_M \vdash x[\sigma(y)/x]_M \equiv \sigma(y)_M \equiv y : A_M
\]
Then, given morphisms $\Gamma; x : A \vdash f : B$ and $\Gamma; y : B \vdash g : C$, we see that functoriality of $M$ follows directly from functoriality of substitution. Corresponding to $M(g \circ f)$ we have the term:
\[
\Gamma, z : A_M \vdash g[f/y][\sigma(z)/x]_M : C_M
\].
while $M(g) \circ M(f)$ is given by:
\[
  \begin{split}
    \Gamma, z : A_M &\vdash g[\sigma(f[\sigma(z)/x]_M)/y]_M : C_M \quad \equiv\\
    \Gamma, z : A_M &\vdash g[f[\sigma(z)/x]/y]_M : C_M \quad \equiv\\
    \Gamma, z : A_M &\vdash g[f/y][\sigma(z)/x]_M : C_M
  \end{split}
\]
proving functoriality of $M$.
Functoriality of $L$ is not as immediate. The identity on $A$, $\Gamma, x : A \vdash x : A$ is mapped to:
\[
  \Gamma; y : A_L \vdash \text{let $x$ be $y$ in $x_L$} : A_L
\]



For $\Gamma \vdash A \type$, $\Gamma \vdash B \type$ and $\Gamma \vdash C \type$ and morphisms $\Gamma, x : A \vdash f : B$, $\Gamma, y : B \vdash g : C$ we want "$L(g \circ f)$":
\[
  \Gamma; z : A_L \vdash \text{let $x$ be $z$ in $g[f/y]_L$} : C_L\\
\]
to equal "$L(g) \circ L(f)$":
\[
  \begin{split}
    \Gamma; z : A_L &\vdash \text{let $y$ be (let $x$ be $z$ in $f_L$) in $g_L$} : C_L\\
  \end{split}
\]\\
To reconcile with this we introduce the following commuting conversions:
\[
\inference{\Gamma; \Xi \vdash \text{let $x$ be $t$ in $u_L$} : A_L}{\Gamma; \Xi \vdash \text{let $x$ be $t$ in $u_L$} \equiv (\text{let $x$ be $t$ in $u$})_L : A_L}[L-fun]
\]\\
This is not merely a semantic luxury, but is also syntactically motivated (TODO: WHAT IS SUBFORMULA PROPERTY?). It is now easily seen that $L$ respects the identity morphism, and so to show functoriality, it remains to show $L(g \circ f) = L(f) \circ L(g)$, i.e. that the terms
\[
  \Gamma; z : A_L \vdash \text{let $x$ be $z$ in }g[f/y]_L : C_L
\]
and
\[
  \Gamma; z : A_L \vdash g_L[(\text{let $x$ be $z$ in }f)/y] : C_L
\]
are equal. TODO: this follows from the naturality conditions of substitution.

We will ask for similar commuting conversions for most of our linear terms. A general schema for when they can be applied can be found in \cite{barber1996dual}.\\
Equipped L-fun, we can state our claims about the semantic nature of $L$ and $M$ more precisely.
\begin{thm}[$L \dashv M$]
$L \dashv M$ is a fiberwise adjunction between $\mathcal{L}$ and $\mathcal{T}$.
\begin{proof}
We will show that there is a vertical natural transformation $\epsilon : LM \to 1$ satisying the following universal property: 
For any $f : L(A) \to B$, there is a unique morphism $g : A \to B_M$, such that $\epsilon_B \circ L(g) = f$.\\
Translated into the syntax of our type theory, the statement becomes the following:\\
Let $\Gamma$ be a cartesian context and $\Gamma \vdash A \type$, $\Gamma \vdash B \linear$. There is a term $\Gamma; \beta_1 : B_{LM} \vdash \epsilon_B: B$ with the following property:\\
For any term: $\Gamma; y : A_L \vdash f : B$, there is a unique term $\Gamma, x : A \vdash g : B_{M}$ such that $\Gamma; y : A_L \vdash \epsilon_B[\text{let $x$ be $y$ in }g_L/\beta_1] \equiv f : B$.\\
 The counit $\epsilon : LM \to 1_{\mathcal{L}_{\Gamma}}$ is at any component $B$ given by:
 \[
  \begin{split}
    \Gamma, \beta_1 : B_{M} &\vdash \beta_1 : B_{M}\\
    \Gamma, \beta_2 : B_{M} &\vdash \beta_2 : B_{M}\\
    \Gamma, \beta_2 : B_{M}; &\cdot \vdash \sigma(\beta_2) : B\\
    \Gamma; \beta_1 : B_{LM} &\vdash \text{let $\beta_2$ be $\beta_1$ in }\sigma(\beta_2) : B 
  \end{split}
\]
  where the last line is given by applying L-E to the first and third line.\\
  For any $\Gamma; x : A_L \vdash f : B$, we get the corresponding $g$ through:
  \[
    \begin{split}
      \Gamma, x : A &\vdash x : A\\
      \Gamma, x : A; \cdot &\vdash x_L : A\\
      \Gamma, x : A; \cdot &\vdash f[x_L/y] : B\\
      \Gamma, x : A &\vdash f[x_L/y]_M : B_M
      \end{split}
    \]
    making $Lg$ the term:
\[
  \begin{split}
    \Gamma; y : A_L &\vdash \text{let $x$ be $y$ in } f[x_L/y]_{LM} : B_{LM}
  \end{split}
\]
our composite $\epsilon_B \circ Lg$ is given by substituting the above for $\beta_1$ in the term correpsonding to $\epsilon_B$, yielding:
\[
  \Gamma; y : A_L \vdash \text{let $\beta_2$ be (let $x$ be $y$ in $f[x_L/y]_{LM}$) in }\sigma(\beta_2) : B
\]
Finally, if we substitute $x_L$ for $y$ in the above, we can rewrite the expression using L-C to:
\[
  \begin{split}
    \Gamma, x : A; \cdot &\vdash \text{let $\beta_2$ be $f_{LM}$ in }\sigma(\beta_2) : B \equiv \\
    \Gamma, x : A; \cdot &\vdash \sigma(\beta_2)[f_M / \beta_2] \equiv f : B
  \end{split}
\]
so by L-U, we can transform this equality to the desired
\[
\Gamma; y : A_L \vdash \text{let $\beta_2$ be (let $x$ be $y$ in $f[x_L/y]_{LM}$) in }\sigma(\beta_2) \equiv f : B
\]
  It remains to show that for any other term $\Gamma; x : A \vdash h : B_M$ such that $\epsilon_B \circ Lh = f$, we have $g = h$. Syntactically, $\epsilon_B \circ Lh = f$  corresponds to the judgement:
  \[
    \Gamma; y : A_L \vdash \text{let $\beta_2$ be $(\text{let $x$ be $y$ in $h_L$})$ in }\sigma(\beta_2) \equiv f : B
  \]
  If we weaken the cartesian context by $x : A$, we can substitute $x_L$ for $y$ and get:
  \[
    \begin{split}
      \Gamma, x : A; \cdot \vdash \text{let $\beta_2$ be $(\text{let $x$ be $x_L$ in $h_L$})$ in }\sigma(\beta_2) \equiv \sigma(h) \equiv f[x_L/y] : B
    \end{split}
    \]
    finally, we apply $M$ and get:
    \[
      \Gamma, x : A \vdash \sigma(h)_M \equiv h \equiv f[x_L/y]_M : B
    \]
\end{proof}
\end{thm}
\subsubsection{Linear dependent types}
Since we allow linear types to dependend on terms of cartesian types, we can form new versions of the $\Pi$- and $\Sigma$-types. We will denote these linear variants of $\Pi$- and $\Sigma$-types by $\sqcap$ and $\sqsubset$, respectively.\\
\fbox{
\begin{minipage}{.5\linewidth}
\[
\inference{\Gamma \vdash A \type \quad \Gamma, x : A \vdash B \linear}{\Gamma \vdash \sqcap_{x : A}B \linear}[$\sqcap$-F]
\]\\
\[
\inference{\Gamma, x : A; \Xi \vdash b : B}
{\Gamma; \Xi \vdash \lambda x. b : \sqcap_{x: A}B}[$\sqcap$-I]
\]\\
\[
\inference{\Gamma; \Xi \vdash t : \sqcap_{x : A}B \quad \Gamma \vdash a : A}
{\Gamma; \Xi \vdash t(a) : B[a/x]}[$\sqcap$-E]
\]\\
\[
\inference{\Gamma; \Xi \vdash \lambda x. b (a) : \sqcap_{x : A}B}
{\Gamma; \Xi \vdash \lambda x. b (a) \equiv b[a/x] : B[a/x]}[$\sqcap$-C]
\]
\end{minipage}
\begin{minipage}{.5\linewidth}
\[
\inference{\Gamma \vdash A \type \quad \Gamma, x : A \vdash B \linear}{\Gamma \vdash \sqsubset_{x : A}B \linear}[$\sqsubset$-F]
\]\\
\[
\inference{\Gamma \vdash s : A \quad \Gamma; \Xi \vdash b : B[s/x]}{\Gamma; \Xi \vdash (s, b) : \sqsubset_{x : A}B}[$\sqsubset$-I]
\]\\
\[
\inference{\Gamma; \Xi \vdash t : \sqsubset_{x : A}B \quad \Gamma, x : A; \Xi', y : B \vdash c : C}{\Gamma; \Xi, \Xi' \vdash \text{let $x, y$ be $t$ in c : C}}[$\sqsubset$-E]
\]\\
\[
\inference{\Gamma; \Xi \vdash \text{let $x, y$ be $(s, t)$ in c : C}}
{\Gamma; \Xi \vdash \text{let $x, y$ be $(s, t)$ in c} \equiv c[s/x][t/y]}[$\sqsubset$-C]
\]
\end{minipage}
}\\
An example of a $\sqcap$ type, consider for any linear type $\Gamma \vdash A \linear$, the n-fold tensor product $A^n :\equiv A \otimes A \dots A$, which we can define by induction over the natural numbers (using universes) via:
\[
  \begin{split}
  A^0 &:\equiv I\\
  A^{\text{suc }(n)} &:\equiv A \otimes A^n
  \end{split}
\]
with this construct, recall the example of burning hydrogen given in \ref{burn}, now expressed as a linear function $burn : O_2 \otimes H_2 \otimes H_2 \multimap H_2O \otimes H_2O$. With a dependent, linear function type, we can generalize this process to the function:
\[
  \begin{split}
  burn : \sqcap_{n : \mathbb{N}}O_2^n \otimes H_2^{2n} \multimap H_2O^{2n}
  \end{split}
\]
\\
An example of the $\sqsubset$ type comes from Krishnaswami's treatment of linear dependent logic as a way to model imperative programs \cite{krishnaswami}. Here, a primitive type of memory locations, $\Gamma \vdash Loc \type$, is introduced, the terms $x$ of which can reference a term of any cartesian type $A$ by means of a term of the linear pointer type $[x \mapsto A]$:
\[ 
  \inference{\Gamma \vdash A \type}
  {\Gamma, x : Loc \vdash [x \mapsto A] \linear}
\]
Given a term $\Gamma \vdash t : A$, one can allocate a memory block of memory to store $t$ at a new location, returning a pointer:
\[
  \inference{\Gamma \vdash t : A}
  {\Gamma; \cdot \vdash new_A (t) : \sqsubset_{x : Loc} [x \mapsto A]}
\]


Another example takes inspiration from the realm of blockchain technology, where one deals with resources like bitcoin or ether balances. Say we model ownership of ether by a public address (generated from a cryptographic public key) having the linear type $addr_1 : ETH$. Then we can model a decentralized  mathematical prize comittee, which give out a reward of 1 ether to whoever proves the Goldbach conjecture.\\
Since the reward is constant, this is ais not truly a dependent linear function and we abusively notate it by $\multimap$:
\[
\cdot; x : ETH \vdash GoldbachReward: \Pi_{x : \mathbb{N}}\Sigma_{y, z : \mathbb{N}}Prime(y) \times Prime(z) \times y + z =_{\mathbb{B}} 2(suc(suc(x))) \multimap ETH
\]
To execute the transaction, one would need to exhibit that there is an address $x$ with one ether to begin with and provide a proof of the Goldbach conjecture.\\
\subsection{Universes}
Our cartesian and linear types live in separate universes, $U$ and $L$. Since linear types are type checked in a purely cartesian context, the linear universe is a cartesian type. Our universes are given á la Tarski and are closed under the type formers associated with them. Below, we only outline the closure over the type formers $\Pi$, $\otimes$ and $\sqcap$, but this should be sufficient to give the idea. For more detail we refer to Hofmann's \textit{Syntax and Semantics of Dependent types}, \cite{hofmann1997syntax}, or Krishnaswami's \textit{Integrating Linear and Dependent types}, \cite{krishnaswami}.\\
\fbox{
  \begin{minipage}{.5\linewidth}
    \[
      \inference{\vdash \Gamma \text{ ctxt}}{\Gamma \vdash U \type}[$\mathcal{U}$-F]
    \]\\
    \[
      \inference{\Gamma \vdash t : U}{\Gamma \vdash El(t) \type}[U-El-F]
    \]\\
    \[
      \inference{\Gamma \vdash t : U \\
        \Gamma, x : El(t) \vdash v : U}
        {\Gamma \vdash \hat \Pi_{x : El(t)}v}[U-$\Pi$]
      \]\\
      \[
        \inference{\Gamma \vdash t : U \\
        \Gamma, x : El(t) \vdash v : U}
        {\Gamma \vdash  El(\hat \Pi_{x : El(t)}v) \equiv \Pi_{x : El(t)}El(v)}[U-$\Pi$-Ty]
      \]
\end{minipage}
\begin{minipage}{.5\linewidth}
        \[
      \inference{\vdash \Gamma \text{ ctxt}}{\Gamma \vdash L \type}[L-F]
    \]\\
    \[
      \inference{\Gamma \vdash t : L}{\Gamma \vdash El(t) \linear}[L-El-F]
    \]\\
    \[
      \inference{\Gamma \vdash t : L \quad \Gamma \vdash s : L}{\Gamma \vdash t \hat \otimes s : L}[L-$\otimes$]
    \]\\
        \[
          \inference{\Gamma \vdash t : L \\
            \Gamma \vdash s : L}{El(t \hat \otimes s) \equiv El(s) \otimes El(t)}[L-$\otimes$-Ty]
    \]\\
    \[
      \inference{\Gamma \vdash t : U\\
        \Gamma, x : El(t) \vdash s : L}
        {\Gamma \vdash \hat \sqcap_{x : El(t)} s : L}[L-$\sqcap$]
    \]\\
    \[
      \inference{\Gamma \vdash t : U\\
        \Gamma, x : El(t) \vdash s : L}
        {\Gamma \vdash El(\hat \sqcap_{x : El(t)} s) \equiv \sqcap_{x : El(t)}El(s)} [L-$\sqcap$-Ty]
    \]\\
  \end{minipage}
}\\
\section{Semantics}
\subsection{Structural semantic core}
To explore the models of linear dependent type theory we begin by constructing a categorical structure which abstracts the key features of the theory. We will utilize the notion of a \textit{comprehension category}, which provides the most general structure in which we can deal with the structural rules like context extensions and substitutions. Once this has been taken care of we may consider what extra conditions have to be imposed in order for the model to support various type constructors, and then provide concrete models that satisfy these conditions.\\

There are only two type constructors that will be assumed in the general semantic structure: the linear tensor product and unit. This simplifies the core semantics by allowing us to use symmetric monoidal categories instead of multicategories when interpreting linear types.

The idea behind the core of the semantics is to construct a comprehension category \cite{jacobs}, consisting of a base category of contexts, a 'cartesian' fibration consisting of cartesian types equipped with context extensions, and a lax symmetric monoidal fibration consisting of linear types.
\begin{defn}
A \textbf{comprehension category} consists of a commutative diagram of functors
\[
\ti
\mathcal{T} \ar[rd, "p"] \ar[r, "\pi"]  & \mathcal{C}^{\to} \ar[d, "\text{cod}"]\\
& \mathcal{C}
\kz
\]
where $B^\to$ is the arrow category of $B$ and $cod : B^\to \to B$ denotes the codomainfunctor such that:
\begin{enumerate}%
\item $\mathcal{C}$ has a terminal object
\item $p : \mathcal{T} \to \mathcal{C}$ is a Grothendieck fibration,
\item $\pi : \mathcal{T} \to \mathcal{C}^\to$ takes cartesian morphisms in $\mathcal{T}$ to cartesian morphisms in $\mathcal{C}^\to$
\end{enumerate}
Notice that by the second condition, cartesian morphisms in $\mathcal{T}$ are mapped to pullback squares in $\mathcal{C}$:\\
A cartesian morphism $(p, q) : f \to g$ in $\mathcal{C}^\to$ is a commutative square in $\mathcal{C}$
\[
\ti
B \ar[r, "g"] \ar[d, "p"] & B' \ar[d, "q"]\\
A \ar[r,"f"] & A'
\kz
\]
such that for any $E'$, $E$, $q' : E' \to B'$, $e : E \to E'$ and $p' : E \to A$ as in the following diagram:
\[
\ti
E \ar[d, "id_E"] \ar[r, "e"] & E' \ar[d, "q'"] \\
E \ar[d, "p'"] \ar[r, "q'e"] & B' \ar[d,"q"] \\
A \ar[r, "f"] & A'
\kz
\]
there is a unique arrow $u : E \to B$ such that $p' = p \circ u$ and $q'e = g \circ u$. This is precisely the universal property of the pullback.
If $\mathcal{C}$ has all pullbacks, then $\text{cod} : \mathcal{C}^\to \to \mathcal{C}$ is a fibration and we immediately have a comprehension category.
Maps of $\mathcal{C}$ that arise via $\pi(A)$ for some $A \in \mathcal{T}$ will be called \textit{projections}, and by the remark above, pullbacks of projections always exist. Terms of a type will be interpreted as sections of the corresponding projections. The pullbacks of $\mathcal{C}$ will play the role of substitutions in the type theory, and since substitution is strictly associative in the theory, we need pullbacks of $\mathcal{C}$ to be strictly associative too. This requirement forces us to restrict our attention to \textit{split comprehension categories}, i.e. comprehension categories such that $p$ is a split fibration.
\end{defn}
A semantics for linear dependent type theory consists of a split comprehension $p : \mathcal{T} \to \mathcal{C}$ and a split lax monoidal fibration $q : \mathcal{L} \to \mathcal{C}$, illustrated in the following picture:
\[
\ti
\mathcal{L} \ar[rd, "q"] & \mathcal{T} \ar[d, "p"] \ar[r, "\pi"] & \mathcal{C^\rightarrow} \ar[ld, "\text{cod}"]\\
& \mathcal{C}
\kz
\]

This structure is sufficient for interpreting the structural core of our theory. We make this precise by proving soundness by induction on the derivation rules of Figure \ref{struc}. The following lemma will come in handy:
\begin{lem}\label{pb-lem}
  The pullback of an arrow, $g$, has a section if $g$ does. In other words, given a pullback of $g$:
  \[
    \ti
    A \times_{C} B \ar[d, "g^*"] \ar[r, "k"] & B \ar[d, "g", bend right]\\
    A \ar[r, "f"] & C \ar[u, "h", bend right]
    \kz
  \]
  such that $gh = 1_C$, then $h^*$ exists and is a section of $g^*$.
\begin{proof}
Since $A$ with projections $1_A$ and $hf$ forms a cone to the cospan, there exists a unique map $u : A \to A \times_{C} B$ such that $hfu = k$ and $g^*u = 1_A$, making $u$ a section of $g^*$.
\end{proof}
\end{lem}
\begin{thm}[Soundness]
A split comprehension category $p : \mathcal{T} \to \mathcal{C}$ together with a split lax monoidal fibration $q : \mathcal{L} \to \mathcal{C}$ is a model for the linear dependent type theory consisting of the structural rules presented in Figure \ref{struc} and the $\otimes$- and $I$-types presented in Figure \ref{tensor}.
\begin{proof}
  We construct an interpretation function $[[-]]$, which sends:
  \begin{itemize}
  \item Cartesian contexts $\Gamma$ to objects of $\mathcal{C}$, considered up to definitional equality and renaming of bound variables.
  \item Mixed contexts $\Gamma; \Xi$ to objects of $\mathcal{C}_{[[\Gamma]]}$.
  \item Cartesian types $A$ in $\Gamma$ to objects of $\mathcal{T}_{[[\Gamma]]}$.
  \item Linear types $B$ in $\Gamma$ to objects of $\mathcal{L}_{[[\Gamma]]}$.
  \item Cartesian terms $M : A$ in $\Gamma$ to sections of $\pi([[A]]) : [[\Gamma,A]] \to [[\Gamma]]$.
  \item Linear terms $b : B$ in $\Gamma; \Xi$ to morphisms $[[b]] : [[\Xi]] \to [[B]]$.
  \end{itemize}
Proceeding by induction on the derivation rules, we will often abuse notation slightly and denote semantic objects the same as their syntatic counterparts.
\begin{itemize}
\item Case of CI-Base: $[[\cdot]]$ is the terminal object $\mathbf{1}$ of $\mathcal{C}$.
\item Case of CM-Base: $[[\cdot; \cdot]]$ is the unit of $\mathcal{L}_{\mathbf{1}}$.
\item Case of C-cart-ext: By the induction hypothesis, we are given $A$ in $\mathcal{T}_{\Gamma}$ and need to display an object $\Gamma.A$ in $\mathcal{C}$. This object is the domain of the morphism that $A$ is mapped to via $\pi$:
\[\Gamma.A \xrightarrow {\pi_A} \Gamma\]
\item Case of C-weak-1: Given $A, \Delta \in \mathcal{T}_{\Gamma}$, we send $\Delta$ through the functor $\pi_A^* : \mathcal{T}_\Gamma \to \mathcal{T}_{\Gamma.A}$ induced by lifting the morphism $\pi_A : \Gamma.A \to \Gamma$. The resulting object $\pi_A^*(\Delta)$ will be sent to the context $p(\pi_A^*(\Delta)) = \Gamma.A.\Delta\{\pi_*\}$ via $p$, which is the interpretation of the conclusion of the rule C-weak-1.
\item Case of C-weak-2: Notice that since $\pi$ is a cartesian functor, the context above fits into the following pullback:
\[
\ti
\Gamma.A.\Delta\{\pi_A\} \ar[r, "q"] \ar[d, "\pi_{\Delta\{\pi_A\}}"]  & \Gamma.\Delta \ar[d, "\pi_\Delta"]\\
\Gamma.A \ar[r, "\pi_A"] & \Gamma
\kz
\]
so by lifting $q$ to the monoidal functor $q^* : \mathcal{L}_{\Gamma.\Delta} \to \mathcal{L}_{\Gamma.A.\pi^*(\Delta)}$. The context we are looking for is the image of $\Xi$ under this functor.
\item Case of C-lin-ext: For objects $\Xi$ and $A$ in $\mathcal{L}_{\Gamma}$, we let their tensor product $\Xi \otimes A$ denote the extended context $\Gamma; \Xi, x : A$.
\item Case of Int-exch: For $A$ and $B$ in $\mathcal{T}_{\Gamma}$, $\Gamma.A.B\{\pi_A\}$ and $\Gamma.B.A\{\pi_B\}$ are both pullbacks of the cospan:
\[
\ti
& \Gamma.B \ar[d, "\pi_B"]\\
\Gamma.A \ar[r, "\pi_A"] & \Gamma
\kz
\]
since the cartesian lifts of these arrows are sent to pullback squares in $\mathcal{C}^\to$. Hence they are isomorphic, and so any object $\Gamma'$ in $\mathcal{T}_{\Gamma.A.B\{\pi_A\}}$ may equally well be thought of as an object in $\mathcal{T}_{\Gamma.B.A\{\pi_B\}}$.
\item Case of Lin-exch. Since our lax monoidal fibration is symmetric, we have $\Xi \otimes A \otimes B \otimes \Xi' \cong \Xi \otimes B \otimes A \otimes \Xi'$ in $\mathcal{L}_{\Gamma}$.
\item Case of Weak-L. For any $A \in \mathcal{T}_{\Gamma}$ and morphism $t : \Xi \to A$ in $\mathcal{L}_{\Gamma, \Gamma'}$, we can transfer $t$ along the functor $q_{A, \Gamma}^* : \mathcal{L}_{\Gamma, \Gamma'} \to \mathcal{L}_{\Gamma.A.\Gamma'\{\pi_A\}}$ induced by the map $q_{A, \Gamma'}$ arising from the following pullback diagram:
\[
\ti
\Gamma.A.\Gamma'\{\pi_A\} \ar[r] \ar[d, "q_{A, \Gamma'}"]  & \Gamma.\Gamma' \ar[d, "\pi_\Gamma'"]\\
\Gamma.A \ar[r, "\pi_A"] & \Gamma
\kz
\]
to yield a morphism $q_{A, \Gamma'}^*(t) : q_{A, \Gamma'}^*(\Xi) \to q_{A, \Gamma'}^*(A')$.
\item Case of Weak-I. The morphism $q_{A, \Gamma'}$ above also induces a functor $q_{A, \Gamma'}^* : \mathcal{T}_{\Gamma, \Gamma'} \to \mathcal{T}_{\Gamma.A.\Gamma'.\{\pi_A\}}$.
\item For Int-subst-1, the judgement $\mathcal{J}$ can take three forms:
\[
\mathcal{J} = B[M/x] \text{ type}
\]
\[
\mathcal{J} = b[M/x] : B[M/x]
\]
\[
\mathcal{J} = B[M/x] \text{ linear}
\]
The corresponding categorical structure work by way of relating substitution in the theory to pullbacks in $\mathcal{C}$. We begin with showing that there is a type $B[M/x]$ in the context $\Gamma. \Gamma'[M/x]$.\\
Suppose we are given the following objects of $\mathcal{T}$:
\[
\begin{split}
&A \in \mathcal{T}_{\Gamma}\\
&\Gamma' \in \mathcal{T}_{\Gamma.A}\\
&B \in \mathcal{T}_{\Gamma.A.\Gamma'}\\
\end{split}
\]
and a section:
\[
\begin{split}
&M : \Gamma \to \Gamma.A\\
\end{split}
\]
of the projection $\pi_A$. We first lift $M$ to a cartesian arrow ${M^*} : \Gamma.\Gamma'\{M^*\} \to \Gamma'$, which is sent to the following pullback square by $\pi$:
\[
\ti
\Gamma.\Gamma'\{M^*\} \ar[d, "\pi_{\Gamma'\{M^*\}}"] \ar[r, "q_{(M, \Gamma')}"] & \Gamma.A.\Gamma' \ar[d, "\pi_{\Gamma'}"]\\
\Gamma \ar[r,"M"] & \Gamma.A
\kz
\]
where ${q_{(M, \Gamma')}}$ is some map whose existance is given by the structure of the comprehension. We then lift $q_{(M, \Gamma')}$ to obtain a cartesian arrow $q_{(M, \Gamma')}^* : \Gamma.\Gamma'\{M^*\}.B\{q_{(M, \Gamma')}^*\} \to \Gamma.A.\Gamma'.B$ which fits in the following pullback diagram:
\[
\ti
\Gamma.\Gamma'\{M^*\}.B\{q_{(M, \Gamma')}^*\} \ar[d, "\pi_{B\{q_{(M, \Gamma')}^*\}}"] \ar[r,"q_{(q_{(M, \Gamma')},B)}"] & \Gamma.A.\Gamma'.B \ar[d, "\pi_B"] \\
\Gamma. \Gamma'\{M^*\} \ar[r, "q_{(M, \Gamma')}"]  & \Gamma.A.\Gamma'
\kz
\]
The element $\Gamma.\Gamma'\{M^*\}.B\{q^*_{M,\Gamma'}\}$ of $\mathcal{T}_{\Gamma.\Gamma'\{M^*\}}$ along with its associated projection will be our interpretation of $\Gamma.\Gamma'[M/x] \vdash B[M/x]$.\\
Now suppose there is a section $b : \Gamma.A.\Gamma' \to \Gamma.A.\Gamma'.B$ of the projection $\pi_B$. To display an element of $B[M/x]$ is to give a section of $\pi_{B\{q^*_{(M,\Gamma')}\}}$. By lemma \ref{pb-lem}, we get such a section by pulling back $b$ along $q_{(q_{(M, \Gamma')},B)}$.
\\
Finally, if $B$ is an object of $\mathcal{L}_{\Gamma.A.\Gamma'}$, then the image of $B$ under the functor $q_{(M, \Gamma')}^* : \mathcal{L}_{\Gamma.A.\Gamma'} \to \mathcal{L}_{\Gamma.\Gamma'\{M^*\}}$ will be our interpretation of $B[M/x]$ as a linear type in the context $\Gamma,\Gamma[M/x]$.
\item Case of Int-subst-2. The interpretation of Int-subst-2 is the image of $t$ under $q_{(M, \Gamma')}^*$.
\item Case of Lin-subst. Given morphisms $t : \Xi \otimes A \to B$ and $M : \Xi' \to A$ we get a morphism $t \circ (id_\Xi \otimes M) : \Xi \otimes \Xi' \to B$
\item Case of Int-var. For any $A \in \mathcal{T}_\Gamma$, there is a pullback:
  \[
    \ti
    \Gamma.A.A\{\pi_A\} \ar[r, "\pi_{\{\pi_A\}}"] \ar[d, "\pi_{\{\pi_A\}}"] & \Gamma.A \ar[d, "\pi_A"]\\
    \Gamma.A \ar[r, "\pi_A"] & \Gamma
    \kz
  \]
  But since $\Gamma.A$ and the identity map obviously also forms a cone to the cospan, there is a unique map $v_A : \Gamma.A \to \Gamma.A.A\{\pi_A\}$ such that $\pi_{A\{\pi_A\}} \circ v_A = 1_{\Gamma.A}$. This map is thus the interpretation of the term $x : A$ in $\Gamma, x : A \vdash x : A$.
\item Case of Lin-var. The morphism corresponding to the linear variable term $\Gamma; x : A \vdash x : A$ is given by the identity morphism on $A$ in $\mathcal{L}_{\Gamma}$.
\end{itemize}
\end{proof}
\end{thm}
\subsection{Semantic type formers}
In the following, we assume that the comprehension category comprising the core of our syntax is full.
What it means for a model of linear dependent type theory to \textit{support} $\Pi$-, $\Sigma$ and $Id$-types is directly inhererited from the standard, non-linear case.
\begin{defn}A model of LDTT \textbf{supports $\Pi$-types} if, for all $A \in \mathcal{T}_{\Gamma}$, the induced functor $\pi_A^* : \mathcal{T}_{\Gamma} \to \mathcal{T}_{\Gamma.A}$ has a right adjoint $\Pi_A : \mathcal{T}_{\Gamma.A} \to \mathcal{T}_{\Gamma}$ satisfying the following Beck-Chevalley condition:\\
  For all cartesian morphisms $f : E \to E'$ in $\mathcal{T}$, assume without loss of generality that $E \in \mathcal{T}_{\Gamma}$ and $E' \in \mathcal{T}_{\Delta}$. We have the following pullback square in $\mathcal{C}$:
  \[
    \ti
    \Gamma.E \ar[d, "\pi_E"] \ar[r, "q_{E, E'}"] & \Delta.E' \ar[d, "\pi_{E'}"] \\
    \Gamma \ar[r, "pf"] & \Delta
    \kz
  \]
inducing the following functors between fibers:
  \[
    \begin{split}
      q^*_{E, E'} &: \mathcal{T}_{\Delta.E'} \to \mathcal{T}_{\Gamma.E}\\
      (pf)^* &: \mathcal{T}_{\Delta} \to \mathcal{T}_{\Gamma}\\
      \Pi_E &: \mathcal{T}_{\Gamma.E} \to \mathcal{T}_{\Gamma}\\
      \Pi_{E'} &: \mathcal{T}_{\Delta.E'} \to \mathcal{T}_{\Delta}
    \end{split}    
  \]
  There is a canonical natural transformation $(pf)^*\Pi_{E'} \to \Pi_{E}q^*_{E, E'}$ which we ask for to be natural isomorphism.\\
Analoguously, a model \textbf{supports $\Sigma$-types} if $\pi_A^*$ has a left adjoint satisfying a similar Beck-Chevalley condition for all $A$.
\end{defn}
The semantic counterpart for the mixed types $\sqcap$ and $\sqsubset$ is similar to that of $\Pi$ and $\Sigma$, but instead of $\mathcal{T}$, we ask for adjoints of the induced functors between fibers of $\mathcal{L}$.
\begin{defn}
A model of LDTT \textbf{supports $\sqcap$-types} if, for all $A \in \mathcal{T}_{\Gamma}$, the induced (monoidal) functor $\pi_A^* : \mathcal{L}_{\Gamma} \to \mathcal{L}_{\Gamma.A}$ has a monoidal right adjoint.
It supports $\sqsubset$-types if every $\pi_A^*$ has a monoidal left adjoint.
\end{defn}
\begin{defn}[Id-types]
  A model of LDTT \textbf{supports Id-types} if, for all $A \in \mathcal{T}_{\Gamma}$, there exists an object $Id_A \in \mathcal{T}_{\Gamma.A.A\{\pi_A\}}$ and a morphism $r_A : \Gamma.A \to \Gamma.A.A\{\pi_A\}.Id_{A}$ such that:
  \begin{itemize}
    \item The following diagram commutes:
  \[
    \ti
    \Gamma.A \ar[d, "r_A"] \ar[rd, "v_A"]\\
    \Gamma.A.A\{\pi_A\}.Id_A \ar[r, "\pi_{Id_A}"] & \Gamma.A.A\{\pi_A\}
    \kz
  \]
\item For any commutative diagram:
  \[
    \ti
    \Gamma.A \ar[d, "r_A"] \ar[r] & \Delta.C \ar[d, "\pi_C"]\\
    \Gamma.A.A\{\pi_A\}.Id_A \ar[r] & \Delta
    \kz
  \]
  there exists a lift $\Gamma.A.A\{\pi_A\}.Id_A \to \Delta.C$ making the two triangles commute.
\end{itemize}
\begin{defn}
  A model of linear depenendent type theory supports $[-,-]$-types, if, for all objects $A, B \in \mathcal{L}_{\Gamma}$, there exists an object $T[A, B] \in \mathcal{T}_{\Gamma}$ such that $\mathcal{T}_{\Gamma}(X, T[A, B]) \cong \mathcal{L}_{\Gamma.X}(A, B)$.
\end{defn}

\end{defn}

\newpage
\section{Models}
\subsection{Set indexed families}
Our first model will be based on the standard set-theoretic interpretation of dependent type theory \cite{hofmann1997syntax}. The extension of this model to the linear realm is fairly straightforward, and provides a good springboard for examples to come. (It is also sufficient for showing that linear dependent type theory is a proper generalisation of both dependent type theory and linear type theory, as outlined in \cite{vakar14}.)

Our linear and cartesian fibrations will both be constructed as fibrations of set indexed families:
\begin{defn}[$Fam(\mathcal{C})$]
For an arbitrary category $\mathcal{C}$, let $Fam(\mathcal{C})$ denote the category whose objects consists of pairs $(S, f)$ where $S$ is a set and $f$ is a function $f : S \to Ob(\mathcal{C})$. Morphisms of $Fam(\mathcal{C})$ are pairs $(u, \alpha) : (S, f) \to (S', g)$ where $u : S \to S'$ and $\alpha : S \to \text{Mor}(\mathcal{C})$ such that $\alpha(s) : f(s) \to g(u(s))$ for all $s \in S$. Composition is given, for two compatible morphisms $(u, \alpha)$ and $(v, \beta)$, by:
\[
(v, \beta) \circ (u, \alpha) = (v \circ u, g(u(s)) \circ f(s))
\]
for all $s \in S$.
\end{defn}
By projecting a family to its indexing set, we get a fibration $p : Fam(\mathcal{C}) \to \mathbf{Set}$, and if $\mathcal{C}$ has a terminal object, $\top$ such that the hom-sets $\mathcal{C}(\top,A)$ are small for all $A \in \mathcal{C}$, we can form a comprehension category by defining $\pi : Fam(\mathcal{C}) \to \mathbf{Set}^\to$ as follows.

On objects, let
\[
\pi(S, f) = fst: \{(s, t) \; | \; s \in S, t : \top \to f(s)\} \to S
\]
For a morphism $(u, \alpha) : (S, f) \to (S', g)$, let
\[
q_{(u,\alpha)} : \{(s, t) \; | \; s \in S, t : \top \to f(s) \} \to \{(s', t') \; | \; s' \in S', t' : \top \to g(s') \}
\]
be defined by $q_{(u, \alpha)}(s, t) = (u(s), \alpha(s) \circ t)$. The functor $\pi$ sends morphisms $(u, \alpha)$ to squares:
\[
\ti
\{(s, t) \; | \; s \in S, t : \top \to f(s) \} \ar[r, "q_{(u, \alpha)}"] \ar[d, "fst"]& \{(s', t') \; | \; s' \in S', t' : \top \to g(s') \} \ar[d, "fst"]\\
I \ar[r, "u"] & J
\kz
\]
in $\mathbf{Set}$.
\\

The cartesian part of our semantic structure will simply be the fibration $p : Fam(\mathbf{Set}) \to \mathbf{Set}$ with $\pi : Fam(\mathbf{Set}) \to \mathbf{Set}^\to$ as outlined above. For the linear part, we choose any symmetric monoidal category $\mathcal{V}$ and form the fibration $q : Fam(\mathcal{V}) \to \mathbf{Set}$. With the functor $I : \mathbf{Set} \to Fam(\mathcal{V})$ defined by mapping a set $S$ to the family constant at the unit of $\mathcal{V}$ and $\otimes : Fam(\mathcal{V}) \times_{\mathbf{Set}} Fam(\mathcal{V}) \to Fam(\mathcal{V})$ induced by the monoidal structure of $\mathcal{V}$, this forms a lax monoidal fibration.


We have the following picture:
\[
\ti
Fam(\mathcal{V}) \ar[rd, "q"]  & Fam(\mathbf{Set}) \ar[d, "p"] \ar[r, "\pi"] & \mathbf{Set}^\to \ar[ld, "cod"] \\
& \mathbf{Set}
\kz
\]

\subsection{Syntactic enriched categories}
As an in depth example construction in the families model of linear dependent type theory, recall the notion of an enriched category in as defined in \ref{enr-cat}.
Our goal is to construct a syntactic analogue of this construction in the families model, such that the interpretation of this is an enriched category. There are two ways of doing this. The first is a kind of meta-construction, in which we ask for the existence of certain types and judgemental equalities to hold, whereas the second, internal definintion, is a type \textbf{Enr-Cat}, whose terms are interpreted as enriched categories. The type \textbf{Enr-Cat} allows us to formulate theorems about enriched categories directly in the syntax, but requires more involved type formers, such as universes, and the following type,
with which we can reason (non-linearly) about the hom-sets of $\mathcal{V}$:\\
\fbox{
\begin{minipage}{.5\linewidth}
  \[
    \inference{\Gamma \vdash A \linear \quad \Gamma \vdash B \linear}
    {\Gamma \vdash [A, B] \type}[hom-F]
  \]
  \[
    \inference{\Gamma; x : A \vdash t : B}
    {\Gamma \vdash [\lambda x. t] : [A, B]}[hom-I]
  \]
\end{minipage}
\begin{minipage}{.5\linewidth}
  \[
    \inference{\Gamma \vdash f : [A, B] \quad \Gamma; \Xi \vdash a : A}
    {\Gamma; \Xi \vdash f(a) : B}[hom-E]
  \]
  \[
    \inference{\Gamma; x : A \vdash t : B \quad \Gamma; \Xi \vdash a : A}
    {\Gamma; \Xi \vdash [\lambda.x.t](a) \equiv t[a/x] : B}[hom-C]
  \]
\end{minipage}
}
In the presence of linear function types ($\multimap$) and the $M$-functor, this type can be just as well be constructed as $(A \multimap B)_M$. However, adding it as a primitive allows us to talk about the hom-sets of $\mathcal{V}$ even when it is not closed.\\
\begin{defn}[meta-theoretic enriched categories]
  A meta-theoretic $\mathcal{V}$-enriched category in a context $\Gamma$ consists of the following data:
 \begin{itemize}
\item A (cartesian) type $\Gamma \vdash A \type$,
\item for any $x, y : A$, a linear type $\Gamma, x, y : A \vdash B_{x, y} \linear$,
\item terms $\Gamma, x, y, z : A; g: B_{y, z}, f:  B_{x, y} \vdash M(g, f) : B_{x, z}$,
\item $\Gamma, x : A; \cdot \vdash j_x : B_{x, x}$ and
\item judgemental equalities $\Gamma, x, y : A; f : B_{x, y} \vdash f \equiv M(j_y \otimes f)$ and $\Gamma, x, y : A; f : B_{x, y} \vdash f \equiv M(f \otimes j_x)$.
\end{itemize}
\end{defn}
Notice that the equation asserting associativity of the composition law is not nessecary, since functions in type theory are inherently associative.
\begin{defn}[Internal enriched categories]
  The type \textbf{Enr-cat} is defined as
  \[
    Enr-Cat :\equiv \Sigma_{A : \mathcal{U}} \Sigma_{B : \Pi_{x, y : A}\mathcal{L}} \Sigma_{M : \Pi_{x, y, z : A} [B_{y, z} \otimes B_{x, y}, B_{x,z}]} \Sigma_{j : \Pi_{x: A}[I, B_{x, x}]}[\lambda f. f] = [\lambda f. M_{x, x, y}(f \otimes j_x)] \times [\lambda f. f] = [\lambda f. M_{x, x, y}(j_y \otimes f)] \\
  \]
\end{defn}
The interpretation of this in the families model are precisely $\mathcal{V}$-enriched categories. A type $A$ in the empty context will be a family of sets indexed by a singleton, and the type $B$ is a function $B : A \times A \to \mathcal{V}$, which for each pair $x, y \in A$ assigns an object of $\mathcal{V}$.
Since $Fam(\mathbf{Set})$ is an extensional model, whenever the $a =_A b$ is inhabited, we have $[[a]]=[[b]]$. Furthermore, since the equalities $p$, $q$ and $r$ are all identifying morphisms in the image of the faithful functor $M$, we have:
\[
[[f \circ 1_x ]] \equiv [[1_y \circ f]] \equiv [[f]]
\]
and
\[
[[h \circ (g \circ f)]] \equiv [[(h \circ g) \circ f]]
\]
for all $f : B_{x,y}$, $g : B_{y,z}$ and $h : B_{z,w}$, demonstrating that composition is unital and associative in the enriched category.
For example, we may choose $\mathcal{V}$ to be the category of groups equipped with the usual tensor product of groups. Here the $L$ functor forms the free abelian group of a set, and the construction above will yield an Ab-enriched category.
\subsection{Diagrams}
Expanding upon the Monoidal Families example given by Vakar \cite{vakar14}, we consider diagrams $J : \mathcal{D} \to \mathcal{V}$ of any shape in a category $\mathcal{V}$. In other words, we construct a category $\diag(\mathcal{V})$ whose objects are functors with $\mathcal{V}$ as codomain and whose morphisms for diagrams $J : \mathcal{D} \to \mathcal{V}$ and $J' :\mathcal{C} \to \mathcal{V}$ are given by functors $F : \mathcal{C} \to \mathcal{D}$ such that $J \circ F = J'$.

From this we get the obvious domain fibration $dom : \diag(\mathcal{V}) \to \textbf{Cat}$.
\begin{thm}
If $\mathcal{V}$ is a monoidal category, $dom$ is a lax monoidal fibration.
\begin{proof}
\end{proof}
\end{thm}
This suggests that we can get a model for linear dependent type theory by letting $\mathcal{L} = \diag(\mathcal{V})$ in the semantic structures given above. But what about the choice of $\mathcal{T}$? One can trivially choose $\mathcal{T} = \mathbf{Cat}$ to get the following picture:
\[
\ti
\diag(\mathcal{V}) \ar[rd, "dom"]  & \mathbf{Cat} \ar[d, "1_{\mathbf{Cat}}"] \ar[r, "Id"] & \mathbf{Cat}^\to \ar[ld, "cod"] \\
& \mathbf{Cat}
\kz
\]
where $Id : \mathbf{Cat} \to \mathbf{Cat}^\to$ is the map sending a category to its identity functor. Another choice would be $\mathcal{T} = \mathbf{Fib}$, the category of grothendieck fibrations, yielding:
\[
\ti
\diag(\mathcal{V}) \ar[rd, "dom"]  & \mathbf{Fib} \ar[d, "Base"] \ar[r, "\mathcal{P}"] & \mathbf{Cat}^\to \ar[ld, "cod"] \\
& \mathbf{Cat}
\kz
\]
where $Base$ is the morphism sending a fibration $p : E \to B \mapsto B$ and $\mathcal{P}$ sends a fibration $p : E \to B$ to its underlying functor $p : E \to B$. For any functor $F : A \to B$ in $\mathbf{Cat}$, there is a pullback:
\[
\ti
A \times_{B} E \ar[r] \ar[d, "F^*(p)"] & E \ar[d, "p"] \\
A \ar[r, "F"] & B
\kz
\]
where $F^*(p)$ is a fibration if $p$ is, by Lemma(Prop 2.6 in comprehension categories). This shows that $\mathcal{P}$ sends cartesian arrows to cartesian arrows. READ EXAMPLE 4.6 in Comprehension cats

One could also restrict $\diag(\mathcal{V})$ to diagrams in $\mathcal{V}$ over groupoids. In that case, $\mathcal{T}$ consists of fibrations of groupoids and the cartsian fragment of the type theory is essentially the groupoid model as presented by Hofmann and Streicher in \cite{hofmann1998}. This suggests that this model can serve as a setting for linear dependent homotopy type theory.

\newpage
We expand this to a functor $\text{Diag}(\mathcal{V}) : \mathbf{Cat}^{op} \to \mathbf{SMCat(-,V)}$ where $\mathcal{C} \xrightarrow{F} \mathcal{D}$ in \textbf{Cat} induces a monoidal functor $[\mathcal{D}, \mathcal{V}] \xrightarrow{(-) \circ F} [\mathcal{C}, \mathcal{V}]$. To highlight the connection to the type theory, we let $A\{F\}$ in  $\diag(\mathcal{V})(\mathcal{C})$ denote the image of any object $A \in \diag(\mathcal{V})(\mathcal{D})$ under this functor. Notice that for any category $\mathcal{C}$, the functor category $[\mathcal{C}, \mathcal{V}]$ naturally carries a monoidal structure by $(F \otimes G)(c) = F(c) \otimes G(c)$, with the constant functor at the unit object $I \in \mathcal{\Ob(V)}$ as unit. This functor will also be denoted $I$.
\begin{thm}[Comprehension in $\diag(\mathcal{V})$]
$Diag(\mathcal{V})$ admits a comprehension. In other words, for any diagram $J : \mathcal{D} \to \mathcal{V}$ there is a representating object $\mathcal{D}.J \xrightarrow{\mathbf{p}_{\mathcal{D}.J}} \mathcal{D}$ in $\mathbf{Cat}_{/\mathcal{D}}$ such that for any morphism $F : \mathcal{C} \to \mathcal{D}$, we have $\diag(\mathcal{V})(\mathcal{C})(I, J\{F\}) \cong \mathbf{Cat}_{/\mathcal{D}}(F, \mathbf{p}_{(\mathcal{D}, J)})$.
\begin{proof}
Let $\mathcal{D}.J$ be given by the slice category $(I \downarrow J)$, whose objects are pairs $(d, j)$, with $d \in \mathcal{D}$, $j \in \Hom(I,J(d))$ and whose morphisms are $f : d \to d'$ such the following diagram commutes:
\[
\ti
I \ar[r, "j"] \ar[rd, "j'"] & J(d) \ar[d,"J(f)"]\\
& J(d')
\kz
\]
Compare this with natural transformations $\eta \in \diag(\mathcal{V})(\mathcal{C})(I, J\{F\}))$. For all objects $c, c' \in \mathcal{C}$ with morphism $c \xrightarrow{f} c'$ we require components $n_{\bullet} : I \to J \circ F(\bullet)$ such that the following diagram commutes:
\[
\ti
I \ar[r, "\eta_c"] \ar[rd, "\eta_{c'}"] & J(F(c)) \ar[d,"J(F(f))"]\\
& J(F(c'))
\kz
\]
Let $p_{\mathcal{D}.J} : (I \downarrow J) \to \mathcal{D}$ be the obvious forgetful functor, $(d, j) \mapsto d$. Now any functor $G : \mathcal{C} \to (I \downarrow J)$ such that $p_{\mathcal{D}.J}G = F$, must be of the form:
\[
\begin{split}
G(c) &= (F(c), g_c)\\
G(f) &= F(f)
\end{split}
\]
where $g_c : I \to F(c)$ is some morphism satisfying the commutativity conditions above. This uniqely defines a natural transformation $g \in \diag(\mathcal{V})(\mathcal{C})(I, J\{F\})$. Furthermore, for any natural transformation $\eta \in \diag(\mathcal{V})(\mathcal{C})(I, J\{F\}$, there is a corresponding functor $\hat \eta : \mathcal{C} \to (I \downarrow J)$ mapping $c \mapsto (F(c), \eta_c)$.
\end{proof}
\begin{lem}
For any groupoid $G$ and functor $A \in [G, \mathcal{V}]$ the comma category $(I \downarrow A)$ is a groupoid, and its associated projection $p_{G.A} : (I \downarrow A) \to G$ is a fibration.
\begin{proof}
A morphism between objects $(g, i)$, $(g', i')$ in $(I \downarrow A)$ are given by a morphism $f : g \to g'$ in $G$ such that $A(f) \circ i = i'$. Since $G$ is a groupoid there exists an inverse $f^{-1}$. That this map yields an inverse of $(I \downarrow A)$ is immediate from the fact that the following diagram in $\mathcal{V}$ commutes:
\[
\ti
I \ar[rd,"i'",swap] \ar[r, "i"] & A(g) \ar[d, "A(f)", bend right,swap] \\
& A(g') \ar[u, "A(f^{-1}) = A(f)^{1}", bend right,swap]
\kz
\]
To see that $p$ is a fibration, let $(g, i)$ be an object of $(I \downarrow A)$ and $f : g \to g'$ an arrow in $G$. Then the object $(g', A(f)\circ i)$ together with $f$ seen as a morphism of $(I \downarrow A)$ form an immediate commutative diagram in $\mathcal{V}$.
\end{proof}
\end{lem}
\begin{cor}
The restriction of $\diag(\mathcal{V})$ to the category of groupoids is also a model for IDLTT.
\end{cor}

\end{thm}
The functor $p_{\mathcal{D}.J}$ will sometimes be referred to as the \textbf{projection} associated to $J$.
Recall that a model $\mathcal{C}, \mathcal{L}$ of ILDTT \textbf{supports $\Sigma$-types} if $\mathcal{L}(p_{\Delta.A})$ has a left adjoint for all $\Delta \in \mathcal{C}$, and $A \in \mathcal{L}(\Delta)$. It \textbf{supports $\Pi$-types} if all $\mathcal{L}(p_{\Delta.A})$ have right adjoints.
In the $Diag(V)$ model, $\Sigma$- and $\Pi$-types are left and right adjoints to the functor $p_* : [\Delta, \mathcal{V}] \to [\Delta.A, \mathcal{V}]$ induced by the projection $p_{\Delta.A} : \Delta.A \to \Delta$. These are precisely the left and right Kan extensions along $p_{\Delta.A}$.
\begin{defn}[coCartesian morphism]
Given a functor $p : E \to B$, an arrow $f : e_1 \to e_2$ is coCartesian with respect to $p$ if, for any pair of morphisms $h : e_1 \to e_3$ and $g : p(e_2) \to p(e_3)$ as in the following commutative diagram:
\[
\ti
p(e_1) \ar[r, "p(f)"] \ar[rd, "p(h)"] & p(e_2) \ar[d, "g"] \\
& p(e_3)
\kz
\]
there exists a unique morphism $\hat g : e_2 \to e_3$ such that $p(\hat g) = g$ and $\hat g f = h$.
\end{defn}
\begin{lem}{unique-target}
For a functor $p : E \to B$ and $f_1 : e_1 \to e_2$, $f_2 : e_1 \to e_3$ two coCartesian morphisms such that $p(f_1) = p(f_2) = \alpha : b_1 \to b_2$, there is a unique isomorphisms $\phi : e_2 \to e_3$ such that the following diagram commutes:
\[
\ti
e_1 \ar[d, "f_1"] \ar[rd, "f_2"] & \\
e_2 \ar[r,"\phi"] &  e_3
\kz
\]
\begin{proof}
Since $f_1$ coCartesian, the composition $Id_{b_2} \circ p(f_1) = p(f_2)$ has a unique lift $\phi : e_2 \to e_3$ in $E$ such that $\phi f_1 = f_2$. Similarly, there is a unqie morphism $\psi : e_3 \to e_2$ such that $\psi f_2 = f_1$. Composing, we get an arrow $\psi \phi f_1 = f_1$. But since we also have $Id_{b_2} \circ p(f_1) = p(f_1)$, the only arrow $\pi : e_2 \to e_2$ such that $\pi f_1 = f_1$ must be the identity on $e_2$, so $\phi$ is a isomorphism.
\end{proof}
\end{lem}
\begin{defn}[Opfibration]
A functor $p : E \to B$ is an \textbf{opfibration} if for every $e_1 \in E$ and arrow $\alpha : p(e_1) \to b$ in the base $B$, there exists a coCartesian arrow $f : e_1 \to e_2$ in $E$ such that $p(f) = \alpha$.
\end{defn}
Given such a fibration, for any object $b \in B$, the objects and morphisms of $E$ that are mapped to $b$ and its identity morphism via $p$ form a category, $E_b$, called the $\textbf{fiber}$ over $b$. From any map $f : b \to b'$ in the base we can construct a functor $\hat f : E_b \to E_{b'}$ by sending $e \in E_b$ to the target of a corresponding coCartesian lift $g : e \to e'$. By the previous lemma, such a functor $\hat f$ will be unique up to unique isomorphism.
\begin{thm}
Given a category $\mathcal{C}$ and functor $A : \mathcal{C} \to \mathcal{V}$, the projection $p : (v \downarrow A) \to \mathcal{C}$ is an opfibration for any $v \in \mathcal{V}$.
\begin{proof}
Let $(c, j: v \to A(c))$ be an object of $(v \downarrow A)$ and $f: c \to c'$ a morphism in $\mathcal{C}$. Then $f$ induces a morphism of between $(c, j)$ and $(c', fj)$ in $(v \downarrow A)$. For any pair of morphisms $h : (c, j) \to (c'', j'')$ and $g : c' \to c''$ such that the following diagram commutes:
\[
\ti
c \ar[r, "f"] \ar[rd, "h"] & c' \ar[d, "g"]\\
& c''
\kz
\]
we have the following commutative diagram in $(v \downarrow A)$:
\[
\ti
& c \ar[d, "f"] \ar[dd, "h", bend left]\\
v \ar[ru, "j"] \ar[rd, "j''"] \ar[r, "f j'"]& c' \ar[d, dotted, "g"]\\
& c''
\kz
\]
Furthermore, since morphisms in $(v \downarrow A)$ arise from morphisms in $\mathcal{C}$, $g$ is the unique candidate.
\end{proof}
\end{thm}
\begin{thm}
Let $p : \mathcal{C} \to \mathcal{D}$ be an opfibration and $\mathcal{V}$  cocomplete. Then there exists a functor $Lan_p : [\mathcal{C}, \mathcal{V}] \to [\mathcal{D}, \mathcal{V}]$ which is a left kan extension of $p$.
\begin{proof}
For any functor $Y \in [\mathcal{C}, \mathcal{V}]$, let $Lan_p(Y)$ be given by:
\[
\begin{split}
Lan_p(Y)(d) &:= \lim_{\to}(\mathcal{C}_d \hookrightarrow \mathcal{C} \xrightarrow{Y} \mathcal{V})\\
\end{split}
\]
The action of $Lan_p(Y)$ on morphisms $f : d \to d'$, arises from the universal mapping property of the colimits. Specifically, one can distinguish between two cases. If $d$ is not in the image of $p$, then $Lan_p(Y)(d)$ is the initial object in $\mathcal{V}$ and $Lan_p(Y)(f)$ the unique morphism from it. Otherwise, let $p(c) = d$ for some $c \in \mathcal{C}$ and $\hat f : c \to c'$ be a cocartesian arrow such that $p(\hat f) = f$. We want to show that $Lan_p(Y)(d')$ forms a cocone of the diagram to which $Lan_p(Y)(d)$ is a limit. To that end, let $g : c \to c''$ be an arbitrary morphism in $\mathcal{C}_{d}$. We have the following image:
\[
\ti
Y(c) \ar[r, "\lambda_{Y(c)}"] \ar[dd, "Y(\hat f)",swap, bend right] \ar[d, "Y(g)"]  & Lan_p(Y)(d) \\
Y(c'')  \ar[ru, "\lambda_{Y(c')}"]  \\
Y(c') \ar[r, "\lambda_{Y(c'')}", swap] & Lan_p(Y)(d') \
\kz
\]
But there should also exist a cocartesian arrow $\hat g$ corresponding to $1_d : p(c) \to p(c'')$, so from the following diagram in $\mathcal{D}$:
\[
\ti
p(c) = d \ar[d, "p(\hat f) = f",swap] \ar[r, "p(\hat g) = 1_d"] & p(c'') = d\ar[ld, "f"] \\
p(c') = d'
\kz
\]
there must exist a unique arrow $f' : c'' \to c'$ such that $p(f') = f$ and $f' \hat g = \hat f$. This implies that $Lan_p(Y)(d')$ forms a cocone over the diagram in question, so we can define the $Lan_p(Y)(f)$ to be the unique map $Lan_p(Y)(d) \to Lan_p(Y)(d')$.
The action of $Lan_p$ on natural transformations $\epsilon : Y \to Z$ is similarly induced by the UMP of the colimits at each component.
\\
We show  $Lan_p \dashv p_*$ by exhibiting the unit $\eta :  1_{[\mathcal{D}, \mathcal{V}]} \to Lan_pp_*$ with the following universal property. For objects $Y \in [\mathcal{C}, \mathcal{V}]$, $X \in [\mathcal{D}, \mathcal{V}]$ and morphism $f : Y \to X \circ p$ there is a unique morphism $g : Lan_p(Y) \to X$  such that the following diagram commutes:
\[
\ti
Y \ar[d, "\eta_Y"] \ar[rd, "f"]\\
Lan_p(Y) \circ p \ar[r, "p*(g)"] &  X \circ p
\kz
\]
Again, $g$ arises from the universal property of the colimit: For a given $d \in \mathcal{D}$, all $c \in \mathcal{C}$ such that $p(c) = d$ are mapped to the same object by $X \circ p$, so $X \circ p(c)$ forms a cocone over the diagram $\mathcal{C}_{p(c)} \hookrightarrow \mathcal{C} \xrightarrow{Y} \mathcal{V}$. But $Lan_p(Y)(p(c))$ is the colimit of that diagram, so the $g$ arises from the unique map from the colimit to the cocone.
\end{proof}
\end{thm}
Dually, we can use the same argument to conclude that when $\mathcal{V}$ has all limits, the right Kan extension along $p$ exists.
\begin{cor}
If $\mathcal{V}$ has all colimits, then $\diag(\mathcal{V})$ supports $\Sigma$-types. If $\mathcal{V}$ has all limits, then $\diag(\mathcal{V})$ supports $\Pi$-types.
\end{cor}
\subsection{Spectra}
%\subsection{Monoidal groupoids}
%Given any bicategory $\mathcal{B}$, there is a monoidal groupoid $End(b)$ of endomorphisms of an object $b \in \mathcal{B}$ with 1-cells $f : b \to b$ as objects and invertible 2-cells $\eta : f \implies f'$ as morphisms. The monoidal structure of $End(b)$ is given by composition: $f \otimes f' = f'\circ f$. In particular, if $\mathcal{B} = \mathbf{Cat}$, then we have $End(\mathcal{C})$ a monoidal groupoid consisting of functors and natural isomorphisms.\\

\newpage


\section{Ideas}
H-spaces generalized to the tensor product?
\subsection{Dependent ordered type theory}
If one were to drop exchange as a structural rule, this should correspond to dropping the requirement of the semantic category being symmetric. A particular construction which might be interesting to explore in this setting would be simplicial sets equipped with the join. Would this work?
\nocite{benton1995mixed}
\nocite{hofmann1997syntax}
\bibliographystyle{plain}
\bibliography{refs.bib}
\end{document}

